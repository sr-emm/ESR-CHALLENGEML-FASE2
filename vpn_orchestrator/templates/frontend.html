<!DOCTYPE html><html lang="es" class="dark"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Generador VPN: FortiGate vs Palo Alto</title>    <script src="https://cdn.tailwindcss.com"></script>    <script>        tailwind.config = {            darkMode: 'class',            theme: {                extend: {                    colors: {                        gray: {                            850: '#1f2937',                            900: '#111827',                            950: '#030712',                        },                        forti: {                            DEFAULT: '#C53030',                            dim: '#7F1D1D'                        },                        palo: {                            DEFAULT: '#0284c7',                            dim: '#0c4a6e'                        }                    }                }            }        }    </script>    <style>        body {            font-family: 'Courier New', Courier, monospace;        }        /* Custom scrollbar */        ::-webkit-scrollbar { width: 8px; }        ::-webkit-scrollbar-track { background: #1f2937; }        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }                .input-dark {            background-color: #374151; /* Gray-700 */            border: 1px solid #4b5563; /* Gray-600 */            color: #f3f4f6; /* Gray-100 */            height: 2.5rem; /* h-10 (40px) fixed height for all inputs */            display: flex;            align-items: center;        }        .input-dark:focus {            border-color: #60a5fa;             ring: 2px solid #60a5fa;            outline: none;        }        select.input-dark {            padding-top: 0.25rem;            padding-bottom: 0.25rem;        }        option:disabled {            color: #9ca3af;            font-style: italic;            background-color: #374151;        }                .label-fixed {            display: flex;            align-items: center;            height: 100%;        }    </style></head><body class="bg-gray-950 text-gray-100 min-h-screen p-4 md:p-8">    <div class="max-w-7xl mx-auto space-y-8">                <!-- Header -->        <div class="text-center space-y-2">            <h1 class="text-4xl font-bold tracking-tight bg-gradient-to-r from-red-500 via-gray-200 to-sky-500 bg-clip-text text-transparent">                VPN Orchestrator            </h1>            <p class="text-gray-400 text-sm">FortiGate <-> Palo Alto Networks // Route-Based VPN (No NAT)</p>        </div>        <form id="vpnForm" class="space-y-6">            <!-- 1. GLOBAL SETTINGS CARD -->            <div class="bg-gray-900 border border-gray-800 rounded-xl p-6 shadow-xl">                <h2 class="text-xl font-bold text-gray-200 mb-4 flex items-center gap-2 border-b border-gray-800 pb-2">                    <span class="w-2 h-6 bg-purple-500 rounded-full"></span>                    Configuración Global del Túnel                </h2>                                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">                    <div class="space-y-1">                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider">Nombre del Túnel</label>                        <input type="text" name="tunnel_name" value="S2S-OVERLAY" class="w-full rounded-md px-3 input-dark transition-all focus:ring-1 focus:ring-purple-500" required>                    </div>                                        <div class="space-y-1">                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider">Pre-Shared Key</label>                        <div class="relative">                            <input type="text" name="psk" value="FortinetVPN2025a1!" class="w-full rounded-md px-3 input-dark text-sm focus:ring-1 focus:ring-purple-500" required>                        </div>                    </div>                    <div class="space-y-1">                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider">Diffie-Hellman</label>                        <select name="dh_group" class="w-full rounded-md px-3 input-dark focus:ring-1 focus:ring-purple-500">                            <option value="5">Group 5 (Legacy)</option>                            <option value="14" selected>Group 14 (Standard)</option>                            <option value="19">Group 19 (PFS - High)</option>                            <option value="21">Group 21 (PFS - Ultra)</option>                        </select>                    </div>                    <div class="space-y-1">                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider">Perfil Cifrado</label>                        <select id="crypto_profile" name="crypto_profile" class="w-full rounded-md px-3 input-dark focus:ring-1 focus:ring-purple-500">                            <option value="DES-SHA256" class="text-yellow-400">1. LAB (DES-SHA256)</option>                            <option value="AES128-SHA256" selected class="text-green-400">2. Producción (AES128-SHA256)</option>                            <option value="AES256-SHA256" class="text-emerald-400">3. Seguridad (AES256-SHA256)</option>                        </select>                    </div>                </div>            </div>            <!-- 2. SIDE-BY-SIDE CONFIGURATION -->            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">                <!-- LEFT COLUMN: FORTIGATE -->                <div class="bg-gray-900 border border-red-900/30 rounded-xl overflow-hidden shadow-lg relative">                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-red-700 to-red-500"></div>                                        <div class="p-6 space-y-6">                        <div class="flex items-center justify-between border-b border-gray-800 pb-4">                            <h2 class="text-lg font-bold text-red-400 flex items-center gap-2">                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>                                Site A: FortiGate                            </h2>                            <span class="text-xs text-gray-500 bg-gray-800 px-2 py-1 rounded border border-gray-700">root VDOM</span>                        </div>                        <!-- Management & WAN -->                        <div class="grid grid-cols-2 gap-4">                            <div>                                <label class="text-xs text-gray-500 block mb-1">MGMT IP</label>                                <input type="text" name="fg_mgmt_ip" value="10.100.100.151" class="w-full input-dark rounded px-3 text-sm border-l-4 border-l-red-600">                            </div>                            <div>                                <label class="text-xs text-gray-500 block mb-1">WAN IP (Public)</label>                                <input type="text" name="fg_wan_ip" value="10.100.100.151" class="w-full input-dark rounded px-3 text-sm">                            </div>                        </div>                        <!-- Credentials -->                        <div class="grid grid-cols-2 gap-4">                            <div>                                <label class="text-xs text-gray-500 block mb-1">User</label>                                <input type="text" name="fg_user" value="admin" class="w-full input-dark rounded px-3 text-sm">                            </div>                            <div>                                <label class="text-xs text-gray-500 block mb-1">Password</label>                                <input type="password" name="fg_password" value="1234wasd" class="w-full input-dark rounded px-3 text-sm">                            </div>                        </div>                        <hr class="border-gray-800">                        <!-- Interfaces Configuration (Dropdowns) -->                        <div class="space-y-4">                            <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider">Configuración Interfaces</h3>                                                        <!-- WAN Interface -->                            <div class="grid grid-cols-12 gap-4 items-center">                                <label class="col-span-3 text-sm text-gray-300 label-fixed">WAN Intf</label>                                <div class="col-span-9">                                    <select name="fg_wan_intf" id="fg_wan_intf" class="fg-port-select w-full input-dark rounded px-3 text-sm focus:border-red-500">                                        <!-- Options generated by JS -->                                    </select>                                </div>                            </div>                            <!-- LAN 1 -->                            <div class="grid grid-cols-12 gap-4 items-center">                                <label class="col-span-3 text-sm text-gray-300 label-fixed">LAN 1</label>                                <div class="col-span-4">                                    <select name="fg_lan1_intf" id="fg_lan1_intf" class="fg-port-select w-full input-dark rounded px-3 text-sm focus:border-red-500">                                        <!-- Options generated by JS -->                                    </select>                                </div>                                <div class="col-span-5">                                    <input type="text" name="fg_lan1_cidr" value="10.10.10.0/24" class="w-full input-dark rounded px-3 text-sm" placeholder="CIDR">                                </div>                            </div>                            <!-- LAN 2 -->                            <div class="grid grid-cols-12 gap-4 items-center">                                <label class="col-span-3 text-sm text-gray-300 label-fixed">LAN 2</label>                                <div class="col-span-4">                                    <select name="fg_lan2_intf" id="fg_lan2_intf" class="fg-port-select w-full input-dark rounded px-3 text-sm focus:border-red-500">                                        <!-- Options generated by JS -->                                    </select>                                </div>                                <div class="col-span-5">                                    <input type="text" name="fg_lan2_cidr" value="10.10.20.0/24" class="w-full input-dark rounded px-3 text-sm" placeholder="CIDR">                                </div>                            </div>                        </div>                        <!-- Tunnel IP -->                        <div class="bg-red-900/10 p-4 rounded border border-red-900/30 mt-4">                            <label class="text-xs text-red-300 block mb-2 uppercase font-bold">Tunnel VTI IP</label>                            <input type="text" id="fg_tunnel_ip" name="fg_tunnel_ip" value="169.255.1.1" class="w-full bg-gray-800 border border-gray-700 text-white rounded px-3 h-10 text-sm focus:ring-red-500 flex items-center">                        </div>                                                <input type="hidden" name="fg_vdom_name" value="root">                    </div>                </div>                <!-- RIGHT COLUMN: PALO ALTO -->                <div class="bg-gray-900 border border-sky-900/30 rounded-xl overflow-hidden shadow-lg relative">                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-sky-600 to-sky-400"></div>                    <div class="p-6 space-y-6">                        <div class="flex items-center justify-between border-b border-gray-800 pb-4">                            <h2 class="text-lg font-bold text-sky-400 flex items-center gap-2">                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>                                Site B: Palo Alto                            </h2>                            <span class="text-xs text-gray-500 bg-gray-800 px-2 py-1 rounded border border-gray-700">Zone: VPN_Zone</span>                        </div>                         <!-- Management & WAN -->                         <div class="grid grid-cols-2 gap-4">                            <div>                                <label class="text-xs text-gray-500 block mb-1">MGMT IP</label>                                <input type="text" name="pa_mgmt_ip" value="10.100.100.115" class="w-full input-dark rounded px-3 text-sm border-l-4 border-l-sky-600">                            </div>                            <div>                                <label class="text-xs text-gray-500 block mb-1">WAN IP (Public)</label>                                <input type="text" name="pa_wan_ip" value="10.100.100.115" class="w-full input-dark rounded px-3 text-sm">                            </div>                        </div>                        <!-- Credentials -->                        <div class="grid grid-cols-2 gap-4">                            <div>                                <label class="text-xs text-gray-500 block mb-1">User</label>                                <input type="text" name="pa_user" value="admin" class="w-full input-dark rounded px-3 text-sm">                            </div>                            <div>                                <label class="text-xs text-gray-500 block mb-1">Password</label>                                <input type="password" name="pa_password" value="1234wasd" class="w-full input-dark rounded px-3 text-sm">                            </div>                        </div>                        <hr class="border-gray-800">                        <!-- Interfaces Configuration (Ahora Dropdowns) -->                        <div class="space-y-4">                            <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider">Configuración Interfaces</h3>                                                        <!-- WAN Interface -->                            <div class="grid grid-cols-12 gap-4 items-center">                                <label class="col-span-3 text-sm text-gray-300 label-fixed">WAN Intf</label>                                <div class="col-span-9">                                    <select name="pa_wan_intf" id="pa_wan_intf" class="pa-port-select w-full input-dark rounded px-3 text-sm focus:border-sky-500">                                        <!-- Options generated by JS -->                                    </select>                                </div>                            </div>                            <!-- LAN 1 -->                            <div class="grid grid-cols-12 gap-4 items-center">                                <label class="col-span-3 text-sm text-gray-300 label-fixed">LAN 1</label>                                <div class="col-span-4">                                    <select name="pa_lan1_intf" id="pa_lan1_intf" class="pa-port-select w-full input-dark rounded px-3 text-sm focus:border-sky-500">                                        <!-- Options generated by JS -->                                    </select>                                </div>                                <div class="col-span-5">                                    <input type="text" name="pa_lan1_cidr" value="172.16.10.0/24" class="w-full input-dark rounded px-3 text-sm" placeholder="CIDR">                                </div>                            </div>                            <!-- LAN 2 -->                            <div class="grid grid-cols-12 gap-4 items-center">                                <label class="col-span-3 text-sm text-gray-300 label-fixed">LAN 2</label>                                <div class="col-span-4">                                    <select name="pa_lan2_intf" id="pa_lan2_intf" class="pa-port-select w-full input-dark rounded px-3 text-sm focus:border-sky-500">                                        <!-- Options generated by JS -->                                    </select>                                </div>                                <div class="col-span-5">                                    <input type="text" name="pa_lan2_cidr" value="172.16.20.0/24" class="w-full input-dark rounded px-3 text-sm" placeholder="CIDR">                                </div>                            </div>                        </div>                        <!-- Tunnel IP -->                        <div class="bg-sky-900/10 p-4 rounded border border-sky-900/30 mt-4">                            <label class="text-xs text-sky-300 block mb-2 uppercase font-bold">Tunnel Interface IP</label>                            <input type="text" id="pa_tunnel_ip" name="pa_tunnel_ip" value="169.255.1.2" class="w-full bg-gray-800 border border-gray-700 text-white rounded px-3 h-10 text-sm focus:ring-sky-500 flex items-center">                        </div>                        <!-- Hidden fields -->                        <input type="hidden" name="pa_zone_name" value="VPN_Zone">                        <input type="hidden" id="pa_remote_wan_ip" name="pa_remote_wan_ip" value="">                        <input type="hidden" id="pa_remote_tunnel_ip" name="pa_remote_tunnel_ip" value="">                        <input type="hidden" id="fg_remote_wan_ip" name="fg_remote_wan_ip" value="">                        <input type="hidden" id="fg_remote_tunnel_ip_pa" name="fg_remote_tunnel_ip_pa" value="">                    </div>                </div>            </div>            <!-- ACTION BUTTON -->            <div class="pt-4">                <button type="submit" id="generateButton" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-4 rounded-xl shadow-lg transform transition hover:scale-[1.01] flex justify-center items-center gap-3">                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>                    Generar Paquete Ansible (.zip)                </button>                <p id="message" class="text-center mt-4 text-sm font-mono"></p>            </div>        </form>    </div>    <!-- JAVASCRIPT LOGIC -->    <script>        // --- 1. FORTIGATE PORT LOGIC ---        const fgPorts = Array.from({length: 10}, (_, i) => `port${i + 1}`);        const fgSelects = ['fg_wan_intf', 'fg_lan1_intf', 'fg_lan2_intf'];        const fgDefaultValues = { 'fg_wan_intf': 'port1', 'fg_lan1_intf': 'port2', 'fg_lan2_intf': 'port3' };        function initFortiPorts() {            fgSelects.forEach(selectId => {                const select = document.getElementById(selectId);                select.innerHTML = '';                fgPorts.forEach(port => {                    const option = document.createElement('option');                    option.value = port;                    option.text = port;                    select.appendChild(option);                });                select.value = fgDefaultValues[selectId];                select.addEventListener('change', validateFortiPorts);            });            validateFortiPorts();        }        function validateFortiPorts() {            const currentSelections = fgSelects.map(id => document.getElementById(id).value);            fgSelects.forEach((selectId, index) => {                const select = document.getElementById(selectId);                const options = select.options;                for (let i = 0; i < options.length; i++) {                    const optValue = options[i].value;                    const isSelectedElsewhere = currentSelections.some((val, idx) => val === optValue && idx !== index);                    if (isSelectedElsewhere) {                        options[i].disabled = true;                        options[i].text = `${optValue} (En uso)`;                    } else {                        options[i].disabled = false;                        options[i].text = optValue;                    }                }            });        }        // --- 2. PALO ALTO PORT LOGIC ---        const paPorts = Array.from({length: 10}, (_, i) => `ethernet1/${i + 1}`);        const paSelects = ['pa_wan_intf', 'pa_lan1_intf', 'pa_lan2_intf'];        const paDefaultValues = { 'pa_wan_intf': 'ethernet1/1', 'pa_lan1_intf': 'ethernet1/2', 'pa_lan2_intf': 'ethernet1/3' };        function initPaloPorts() {            paSelects.forEach(selectId => {                const select = document.getElementById(selectId);                select.innerHTML = '';                paPorts.forEach(port => {                    const option = document.createElement('option');                    option.value = port;                    option.text = port;                    select.appendChild(option);                });                select.value = paDefaultValues[selectId];                select.addEventListener('change', validatePaloPorts);            });            validatePaloPorts();        }        function validatePaloPorts() {            const currentSelections = paSelects.map(id => document.getElementById(id).value);            paSelects.forEach((selectId, index) => {                const select = document.getElementById(selectId);                const options = select.options;                for (let i = 0; i < options.length; i++) {                    const optValue = options[i].value;                    const isSelectedElsewhere = currentSelections.some((val, idx) => val === optValue && idx !== index);                    if (isSelectedElsewhere) {                        options[i].disabled = true;                        options[i].text = `${optValue} (En uso)`;                    } else {                        options[i].disabled = false;                        options[i].text = optValue;                    }                }            });        }        // --- 3. SYNC REMOTE IPS ---        function syncRemoteIPs() {            const fgWan = document.getElementsByName('fg_wan_ip')[0].value;            const paWan = document.getElementsByName('pa_wan_ip')[0].value;            const fgTunnel = document.getElementById('fg_tunnel_ip').value;            const paTunnel = document.getElementById('pa_tunnel_ip').value;            document.getElementById('pa_remote_wan_ip').value = paWan;            document.getElementById('pa_remote_tunnel_ip').value = paTunnel;            document.getElementById('fg_remote_wan_ip').value = fgWan;            document.getElementById('fg_remote_tunnel_ip_pa').value = fgTunnel;        }        // --- 4. FORM SUBMISSION ---        document.getElementById('vpnForm').addEventListener('submit', async function(event) {            event.preventDefault();            syncRemoteIPs();            const form = event.target;            const data = {};                        for (let i = 0; i < form.elements.length; i++) {                const element = form.elements[i];                if (element.name && !element.disabled) {                    data[element.name] = element.value;                }            }            const messageElement = document.getElementById('message');            const btn = document.getElementById('generateButton');                        messageElement.textContent = 'Generando configuración en servidor...';            messageElement.className = 'text-center mt-4 text-sm font-mono text-yellow-400 animate-pulse';            btn.disabled = true;            btn.classList.add('opacity-50', 'cursor-not-allowed');            try {                // LLAMADA AL BACKEND FLASK                const response = await fetch('/generate', {                    method: 'POST',                    headers: { 'Content-Type': 'application/json' },                    body: JSON.stringify(data)                });                if (response.ok) {                    const blob = await response.blob();                    const url = window.URL.createObjectURL(blob);                    const a = document.createElement('a');                    a.style.display = 'none';                    a.href = url;                    a.download = 'vpn_ansible_config.zip';                    document.body.appendChild(a);                    a.click();                    window.URL.revokeObjectURL(url);                    messageElement.textContent = '¡Descarga Exitosa!';                    messageElement.className = 'text-center mt-4 text-sm font-mono text-green-400';                } else {                    const errorText = await response.text();                    messageElement.textContent = `Error del servidor: ${errorText}`;                    messageElement.className = 'text-center mt-4 text-sm font-mono text-red-500';                }            } catch (error) {                console.error(error);                messageElement.textContent = 'Error de conexión con el servidor.';                messageElement.className = 'text-center mt-4 text-sm font-mono text-red-500';            } finally {                btn.disabled = false;                btn.classList.remove('opacity-50', 'cursor-not-allowed');            }        });        document.addEventListener('DOMContentLoaded', () => {            initFortiPorts();            initPaloPorts();            document.getElementsByName('fg_wan_ip')[0].addEventListener('input', syncRemoteIPs);            document.getElementsByName('pa_wan_ip')[0].addEventListener('input', syncRemoteIPs);            document.getElementById('fg_tunnel_ip').addEventListener('input', syncRemoteIPs);            document.getElementById('pa_tunnel_ip').addEventListener('input', syncRemoteIPs);        });    </script></body></html>