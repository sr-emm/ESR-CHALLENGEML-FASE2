vpn:
  name: "fortigate-paloalto-s1-s2"
  description: "VPN IPSec site-to-site entre Fortigate (Sitio 1) y Palo Alto (Sitio 2)"
  tunnel_network: "169.255.1.0/30"

sites:
  site1:
    name: "sitio1-fortigate"
    role: "primary"
    vendor: "fortigate"

    management:
      hostname: "FGT-S1"
      ip: "CHANGE_ME"
      username: "CHANGE_ME"
      password: "CHANGE_ME"
      protocol: "https"        # https o ssh según uses
      port: 443

    wan:
      interface: "port1"
      ip: "100.100.100.1"
      mask: "255.255.255.252"
      network: "100.100.100.0/30"
      gateway: "100.100.100.2"
      zone: "WAN"

    lans:
      - name: "lan1"
        interface: "port2"
        ip: "10.100.101.251"
        mask: "255.255.255.0"
        network: "10.100.101.0/24"
        zone: "LAN_S1"
      - name: "lan2"
        interface: "port3"
        ip: "10.100.102.251"
        mask: "255.255.255.0"
        network: "10.100.102.0/24"
        zone: "LAN_S1"

    tunnel:
      name: "FGT-to-PA"
      interface_type: "ipsec"
      ip: "169.255.1.1"
      mask: "255.255.255.252"
      zone: "VPN_S1"
      peer_wan_ip: "200.200.200.1"

  site2:
    name: "sitio2-paloalto"
    role: "secondary"
    vendor: "paloalto"

    management:
      hostname: "PA-S2"
      ip: "CHANGE_ME"
      username: "CHANGE_ME"
      password: "CHANGE_ME"
      protocol: "https"
      port: 443

    wan:
      interface: "ethernet1/1"
      ip: "200.200.200.1"
      mask: "255.255.255.252"
      network: "200.200.200.0/30"
      gateway: "200.200.200.2"
      zone: "untrust"

    lans:
      - name: "lan1"
        interface: "ethernet1/2"
        ip: "10.200.201.252"
        mask: "255.255.255.0"
        network: "10.200.201.0/24"
        zone: "trust"
      - name: "lan2"
        interface: "ethernet1/3"
        ip: "10.200.202.252"
        mask: "255.255.255.0"
        network: "10.200.202.0/24"
        zone: "trust"

    tunnel:
      name: "TUN-S2-to-S1"
      interface_type: "tunnel"
      interface: "tunnel.1"
      ip: "169.255.1.2"
      mask: "255.255.255.252"
      zone: "vpn"
      peer_wan_ip: "100.100.100.1"
      virtual_router: "VR1"

ike:
  version: "ikev2"
  psk: "CHANGE_ME_SUPER_SECRET_PSK"
  id_type: "ip"
  site1_id_local: "100.100.100.1"
  site1_id_remote: "200.200.200.1"
  site2_id_local: "200.200.200.1"
  site2_id_remote: "100.100.100.1"

  proposal:
    encryption: "aes256"
    integrity: "sha256"
    dh_group: 14
    lifetime_seconds: 28800

  dpd:
    enabled: true
    interval_seconds: 10
    retries: 3
    action: "restart"        # semántica a mapear por script

  nat_traversal:
    enabled: false

ipsec:
  mode: "tunnel"
  protocol: "esp"

  proposal:
    encryption: "aes256"
    integrity: "sha256"
    pfs_enabled: true
    pfs_dh_group: 14
    lifetime_seconds: 3600

  # Selectores / Proxy-IDs
  selectors:
    - name: "s1-lan1_to_s2-lan1"
      local_subnet:  "10.100.101.0/24"
      remote_subnet: "10.200.201.0/24"
    - name: "s1-lan1_to_s2-lan2"
      local_subnet:  "10.100.101.0/24"
      remote_subnet: "10.200.202.0/24"
    - name: "s1-lan2_to_s2-lan1"
      local_subnet:  "10.100.102.0/24"
      remote_subnet: "10.200.201.0/24"
    - name: "s1-lan2_to_s2-lan2"
      local_subnet:  "10.100.102.0/24"
      remote_subnet: "10.200.202.0/24"

routing:
  site1:
    default_route:
      destination: "0.0.0.0/0"
      gateway: "100.100.100.2"
      interface: "port1"
    remote_routes:
      - destination: "10.200.201.0/24"
        next_hop: "169.255.1.2"
        interface: "FGT-to-PA"
      - destination: "10.200.202.0/24"
        next_hop: "169.255.1.2"
        interface: "FGT-to-PA"

  site2:
    default_route:
      destination: "0.0.0.0/0"
      gateway: "200.200.200.2"
      interface: "ethernet1/1"
      virtual_router: "VR1"
    remote_routes:
      - destination: "10.100.101.0/24"
        next_hop: "169.255.1.1"
        interface: "tunnel.1"
        virtual_router: "VR1"
      - destination: "10.100.102.0/24"
        next_hop: "169.255.1.1"
        interface: "tunnel.1"
        virtual_router: "VR1"

policies:
  site1:
    - name: "LAN_S1_to_VPN_S1"
      src_zone: "LAN_S1"
      dst_zone: "VPN_S1"
      src_subnets:
        - "10.100.101.0/24"
        - "10.100.102.0/24"
      dst_subnets:
        - "10.200.201.0/24"
        - "10.200.202.0/24"
      action: "accept"
    - name: "VPN_S1_to_LAN_S1"
      src_zone: "VPN_S1"
      dst_zone: "LAN_S1"
      src_subnets:
        - "10.200.201.0/24"
        - "10.200.202.0/24"
      dst_subnets:
        - "10.100.101.0/24"
        - "10.100.102.0/24"
      action: "accept"

  site2:
    - name: "trust_to_vpn"
      src_zone: "trust"
      dst_zone: "vpn"
      src_subnets:
        - "10.200.201.0/24"
        - "10.200.202.0/24"
      dst_subnets:
        - "10.100.101.0/24"
        - "10.100.102.0/24"
      action: "allow"
    - name: "vpn_to_trust"
      src_zone: "vpn"
      dst_zone: "trust"
      src_subnets:
        - "10.100.101.0/24"
        - "10.100.102.0/24"
      dst_subnets:
        - "10.200.201.0/24"
        - "10.200.202.0/24"
      action: "allow"

ntp:
  servers:
    - "time.google.com"

tests:
  ping:
    site1:
      source_ips:
        - "10.100.101.251"
        - "10.100.102.251"
      targets:
        - "10.200.201.252"
        - "10.200.202.252"
    site2:
      source_ips:
        - "10.200.201.252"
        - "10.200.202.252"
      targets:
        - "10.100.101.251"
        - "10.100.102.251"

monitoring:
  ike_sa_min: 1
  ipsec_sa_min: 1
  ping_retries: 3
  ping_timeout_seconds: 2
